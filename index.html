<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Green Neon Slope 3D Ultimate</title>
<style>
body{margin:0;overflow:hidden;background:black;font-family:Arial,sans-serif;}
#menu{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;color:#00ff00;}
#menu button{padding:15px 30px;font-size:24px;background:#003300;color:#00ff00;border:none;cursor:pointer;border-radius:10px;}
#score,#highscore{position:absolute;left:20px;z-index:10;color:#00ff00;}
#score{top:20px;font-size:24px;}
#highscore{top:50px;font-size:20px;}
#gameOver{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:white;font-size:40px;display:none;text-align:center;}
#gameOver button{padding:10px 20px;font-size:18px;margin-top:20px;cursor:pointer;}
</style>
</head>
<body>

<div id="menu">
<h1>Green Neon Slope 3D Ultimate</h1>
<button onclick="startGame()">Play</button>
</div>

<div id="score">Score: 0</div>
<div id="highscore">High Score: 0</div>
<div id="gameOver">
Game Over<br>
<button onclick="restart()">Restart</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/examples/js/postprocessing/EffectComposer.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/examples/js/postprocessing/RenderPass.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/examples/js/postprocessing/UnrealBloomPass.js"></script>

<script>
// ---------------- GLOBALS ----------------
let scene, camera, renderer, composer;
let ball;
let obstacles = [], platforms = [], particles = [];
let speed = 0.05;
let score = 0, highScore = 0;
let gameRunning = false;
let keys = {w:false,a:false,s:false,d:false,ArrowUp:false,ArrowDown:false,ArrowLeft:false,ArrowRight:false};
let lastScoreTime = 0;
let ballVelocityX = 0, ballVelocityY = 0, ballVelocityZ = 0;
let tiltX = 0, tiltZ = 0;
let mobileTiltX = 0, mobileTiltY = 0;
let platformZ = 0;

// ---------------- INIT SCENE ----------------
function initScene(){
scene = new THREE.Scene();
scene.fog = new THREE.FogExp2(0x000000,0.02);

// Camera
camera = new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);
camera.position.set(0,5,10);
camera.lookAt(0,0,0);

// Renderer
renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
document.body.appendChild(renderer.domElement);

// Post-processing bloom
composer = new THREE.EffectComposer(renderer);
let renderPass = new THREE.RenderPass(scene,camera);
composer.addPass(renderPass);
let bloomPass = new THREE.UnrealBloomPass(new THREE.Vector2(window.innerWidth,window.innerHeight),1.5,0.4,0.85);
composer.addPass(bloomPass);

// Lights
scene.add(new THREE.AmbientLight(0x555555));
let point = new THREE.PointLight(0x00ff00,1.5,100);
point.position.set(0,20,20);
scene.add(point);

// Grid floor
let size = 1000, divisions = 50;
let grid = new THREE.GridHelper(size,divisions,0x00ff00,0x003300);
grid.rotation.x = Math.PI/2;
grid.position.y = -0.5;
scene.add(grid);

// Ball
let ballGeom = new THREE.SphereGeometry(1,32,32);
let ballMat = new THREE.MeshStandardMaterial({color:0x00ff00,emissive:0x00ff00,emissiveIntensity:0.9});
ball = new THREE.Mesh(ballGeom,ballMat);
ball.position.set(0,1,0);
scene.add(ball);

// Highscore
highScore = localStorage.getItem("highscore")||0;
document.getElementById("highscore").innerText="High Score: "+highScore;

// Obstacles and ramps
createInitialPlatforms();

// Resize
window.addEventListener("resize",()=>{
camera.aspect=window.innerWidth/window.innerHeight;
camera.updateProjectionMatrix();
renderer.setSize(window.innerWidth,window.innerHeight);
composer.setSize(window.innerWidth,window.innerHeight);
});

// Mobile tilt
if(window.DeviceOrientationEvent){
window.addEventListener("deviceorientation",function(event){
mobileTiltX = event.gamma/45;
mobileTiltY = event.beta/45;
},true);
}
}

// ---------------- CONTROLS ----------------
document.addEventListener("keydown",e=>{
if(keys.hasOwnProperty(e.key)) keys[e.key]=true;
});
document.addEventListener("keyup",e=>{
if(keys.hasOwnProperty(e.key)) keys[e.key]=false;
});

// ---------------- PLATFORMS & RAMPS ----------------
function createPlatform(z){
let width=20, depth=15, height=Math.random()*1.5;
let geo = new THREE.BoxGeometry(width,height,depth);
let mat = new THREE.MeshStandardMaterial({color:0x003300,emissive:0x00ff00,emissiveIntensity:0.2});
let plat = new THREE.Mesh(geo,mat);
plat.position.z = z;
plat.position.y = -0.5 + height/2;
plat.rotation.x = (Math.random()-0.5)*0.1;
plat.rotation.z = (Math.random()-0.5)*0.1;
scene.add(plat);
platforms.push(plat);

// Occasionally add obstacle
if(Math.random()<0.25){
let size = Math.random()*1+1;
let obsGeom = new THREE.BoxGeometry(size,size,size);
let obsMat = new THREE.MeshStandardMaterial({color:0x00ff00,emissive:0x00ff00,emissiveIntensity:1});
let obs = new THREE.Mesh(obsGeom,obsMat);
obs.position.z = z - (Math.random()*depth);
obs.position.x = (Math.random()-0.5)*(width-2);
obs.position.y = size/2;
scene.add(obs);
obstacles.push(obs);
}
}

function createInitialPlatforms(){
platformZ=0;
for(let i=0;i<50;i++){
createPlatform(platformZ);
platformZ -= 15;
}
}

// ---------------- PARTICLES ----------------
function spawnParticle(x,y,z){
let geo = new THREE.SphereGeometry(0.05,4,4);
let mat = new THREE.MeshStandardMaterial({color:0x00ff00,emissive:0x00ff00,emissiveIntensity:0.5});
let p = new THREE.Mesh(geo,mat);
p.position.set(x,y,z);
particles.push(p);
scene.add(p);
}

// ---------------- GAME LOOP ----------------
function animate(time){
if(!gameRunning) return;
requestAnimationFrame(animate);

// --- Input movement ---
ballVelocityX = 0;
ballVelocityZ = speed;

if(keys.w||keys.ArrowUp) ballVelocityZ -= speed*0.6;
if(keys.s||keys.ArrowDown) ballVelocityZ += speed*0.4;
if(keys.a||keys.ArrowLeft) ballVelocityX -= speed*0.6;
if(keys.d||keys.ArrowRight) ballVelocityX += speed*0.6;

// Mobile tilt
ballVelocityX += mobileTiltX*speed;
ballVelocityZ -= mobileTiltY*speed/2;

// Ball tilt
tiltX = -ballVelocityX*5;
tiltZ = ballVelocityZ*5;
ball.rotation.x = tiltZ;
ball.rotation.z = tiltX;

// Move ball
ball.position.x += ballVelocityX;
ball.position.z += ballVelocityZ;

// Move obstacles forward
obstacles.forEach(obs=>{
obs.position.z += speed;
if(Math.abs(ball.position.z-obs.position.z)<1 && Math.abs(ball.position.x-obs.position.x)<1){
endGame();
}
});

// Spawn particle trails
spawnParticle(ball.position.x,ball.position.y,ball.position.z);
particles.forEach((p,i)=>{
p.position.z += 0.05;
if(p.position.z>ball.position.z+5){scene.remove(p);particles.splice(i,1);}
});

// Slight camera shake
camera.position.x = ball.position.x + (Math.random()-0.5)*0.02;
camera.position.y = 5 + (Math.random()-0.5)*0.02;
camera.position.z = ball.position.z + 10;
camera.lookAt(ball.position);

// Score increment
if(!lastScoreTime) lastScoreTime = time;
if(time - lastScoreTime >= 1000){
score++;
document.getElementById("score").innerText="Score: "+score;
lastScoreTime = time;
}

// Smooth uphill/downhill
speed = 0.05 + ball.position.z*0.00002;

// Generate new platforms ahead
if(ball.position.z - platformZ < 100){
createPlatform(platformZ);
platformZ -= 15;
}

// Render
composer.render();
}

// ---------------- GAME OVER ----------------
function endGame(){
gameRunning=false;
document.getElementById("gameOver").style.display="block";
if(score>highScore){highScore=score; localStorage.setItem("highscore",highScore); document.getElementById("highscore").innerText="High Score: "+highScore;}
}

// ---------------- START/RESTART ----------------
function startGame(){
document.getElementById("menu").style.display="none";
gameRunning=true;
initScene();
animate();
}

function restart(){ location.reload(); }
</script>
</body>
</html>
